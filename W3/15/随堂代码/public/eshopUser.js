!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.EshopUser=t():e.EshopUser=t()}(self,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function s(e){const{tag:t="div",className:s="",text:a="",children:n=[],attrs:i={},events:o={}}=e,l=document.createElement(t);return s&&(l.className=s),a&&(l.textContent=a),Object.entries(i).forEach((([e,t])=>{l.setAttribute(e,t)})),Object.entries(o).forEach((([e,t])=>{l.addEventListener(e,t)})),n.forEach((e=>{l.appendChild(e)})),l}e.d(t,{default:()=>i});class a{constructor(e={}){this.onSuccess=e.onSuccess||function(){},this.onCancel=e.onCancel||function(){},this.modalElement=null,this.maskElement=null}_createModal(){this.maskElement=s({tag:"div",className:"login-modal-mask"}),this.modalElement=s({tag:"div",className:"login-modal",children:[s({tag:"div",className:"login-modal-header",children:[s({tag:"h3",text:"用户登录"}),s({tag:"button",className:"login-modal-close",text:"×",events:{click:()=>this.hide()}})]}),s({tag:"div",className:"login-modal-content",children:[s({tag:"form",className:"login-form",events:{submit:e=>{e.preventDefault(),this._handleSubmit(e.target)}},children:[s({tag:"div",className:"form-group",children:[s({tag:"label",attrs:{for:"username"},text:"用户名"}),s({tag:"input",attrs:{type:"text",id:"username",name:"username",placeholder:"请输入用户名",required:"true"}})]}),s({tag:"div",className:"form-group",children:[s({tag:"label",attrs:{for:"password"},text:"密码"}),s({tag:"input",attrs:{type:"password",id:"password",name:"password",placeholder:"请输入密码",required:"true"}})]}),s({tag:"button",attrs:{type:"submit"},className:"login-btn",text:"登录"})]})]})]}),document.body.appendChild(this.maskElement),document.body.appendChild(this.modalElement)}show(){this.modalElement||this._createModal(),this.maskElement.style.display="block",this.modalElement.style.display="block",setTimeout((()=>{this.maskElement.classList.add("active"),this.modalElement.classList.add("active")}),10)}hide(){this.modalElement&&(this.maskElement.classList.remove("active"),this.modalElement.classList.remove("active"),setTimeout((()=>{this.maskElement.style.display="none",this.modalElement.style.display="none",this.onCancel()}),300))}_handleSubmit(e){const t=e.username.value.trim(),s=e.password.value.trim();t&&s?fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:s})}).then((e=>{if(e.ok)return e.json();throw new Error("登录失败")})).then((e=>{document.cookie=`eshop_token=${e.token}; path=/`,this.onSuccess(e),this.hide(),setTimeout((()=>{window.location.reload()}),300)})).catch((e=>{console.error("Error:",e),alert("登录失败，请检查用户名和密码")})):alert("请输入用户名和密码")}}const n="https://assets.ericengineer.com/i/2025/02/19/more.png";class i{_state={user:null,token:null};constructor(e){this._params=e,this._container=e.root,this._onInit=e.onInit||function(){},this._init()}_init(){const e=document.cookie||"";if(""===e)return this._container&&this._render(),void this._onInit(this._state);const t={};e.split(";").forEach((function(e){var s=e.split("="),a=s[0].trim(),n=s[1].trim();t[a]=n}));const s=t.eshop_token;s?fetch("/api/user").then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")})).then((e=>{this._state.user=e,this._state.token=s,this._container&&this._render(),this._onInit(this._state)})).catch((e=>{console.error("Error:",e)})):(this._container&&this._render(),this._onInit(this._state)),console.log("EshopUser initialized...")}_render(){const e=s({className:"user-login"});if(this._state.user){const t=s({tag:"img",attrs:{src:"https://assets.ericengineer.com/i/2025/02/19/npvpq4.png",alt:""}}),a=s({className:"avatar",children:[t]}),i=s({children:[s({className:"name",text:`hi~${this._state.user.name||"晚上好"}`}),s({className:"sub-title",text:this._state.user.level||"普通会员"})]}),o=s({className:"user-base-info",children:[a,i]}),l=s({className:"tips",children:[s({className:"title",text:"登入購物平臺後更多優惠"}),s({className:"sub-title",text:"登入可享，專屬優惠，貼心推薦！"})]}),r=s({className:"actions",children:[{img:"https://assets.ericengineer.com/i/2025/02/19/cart.png",text:"购物车"},{img:n,text:"我的订单"},{img:n,text:"我的收藏"},{img:n,text:"优惠券"},{img:n,text:"我的积分"},{img:n,text:"设置"}].map((e=>s({className:"action-item",children:[s({tag:"img",attrs:{src:e.img,alt:e.text}}),s({text:e.text})],events:{click:()=>{console.log(`${e.text} clicked`)}}})))});e.append(o,l,r)}else{const t=s({tag:"img",attrs:{src:"https://assets.ericengineer.com/i/2025/02/19/npvpq4.png",alt:""}}),n=s({className:"avatar",children:[t]}),i=s({children:[s({className:"name",text:"hi~晚上好"}),s({className:"sub-title",text:"注册"})]}),o=s({className:"user-base-info",children:[n,i]}),l=s({className:"tips",children:[s({className:"title",text:"登入購物平臺後更多優惠"}),s({className:"sub-title",text:"登入可享，專屬優惠，貼心推薦！"})]}),r=s({className:"action",text:"立即登入",events:{click:()=>{console.log("登录按钮被点击"),new a({onSuccess:e=>{console.log("登录成功:",e)},onCancel:()=>{console.log("取消登录")}}).show()}}});e.append(o,l,r)}0===this._container.children.length&&this._container.appendChild(e)}}return t.default})()));